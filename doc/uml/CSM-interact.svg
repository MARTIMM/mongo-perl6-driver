<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1240px" preserveAspectRatio="none" style="width:858px;height:1240px;" version="1.1" viewBox="0 0 858 1240" width="858px" zoomAndPan="magnify"><defs><filter height="300%" id="f1gb5c6tisi9u5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#EFFFFF" height="1225.9985" style="stroke: #A80036; stroke-width: 1.0;" width="78" x="340.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="359" y="16.0669">never</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="354" y="31.1997">ending</text><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="1098.9067" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="49.5" y="83.6787"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="1068.666" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="181.5" y="104.9194"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="184.0647" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186.5" y="435.947"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186.5" y="649.2524"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186.5" y="707.7339"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186.5" y="766.2153"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="374.5" y="134.1602"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="982.6846" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="374.5" y="199.9009"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="247.8823"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="335.6045"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="507.0488"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="883.1782"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="1057.6226"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="692.7773" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="550.5" y="306.3638"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="284.4072" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="555.5" y="394.0859"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="695.7773" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="631.5" y="477.8081"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="217.3054" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="636.5" y="578.1506"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="54" x2="54" y1="73.6787" y2="1191.5854"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="186" x2="186" y1="73.6787" y2="1191.5854"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="379.5" x2="379.5" y1="73.6787" y2="1191.5854"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="555" x2="555" y1="73.6787" y2="1191.5854"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="636" x2="636" y1="73.6787" y2="1191.5854"/><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="8" y="38.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="15" y="58.3496">Application</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="8" y="1190.5854"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="15" y="1210.6694">Application</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="158" y="38.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="165" y="58.3496">Client</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="158" y="1190.5854"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="165" y="1210.6694">Client</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="344.5" y="38.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="351.5" y="58.3496">Monitor</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="344.5" y="1190.5854"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="351.5" y="1210.6694">Monitor</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="520" y="38.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="527" y="58.3496">Server1</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="520" y="1190.5854"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="527" y="1210.6694">Server1</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="601" y="38.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="608" y="58.3496">Server2</text><rect fill="#FEFECE" filter="url(#f1gb5c6tisi9u5)" height="30.4131" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="601" y="1190.5854"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="608" y="1210.6694">Server2</text><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="1098.9067" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="49.5" y="83.6787"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="1068.666" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="181.5" y="104.9194"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="184.0647" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186.5" y="435.947"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186.5" y="649.2524"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186.5" y="707.7339"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186.5" y="766.2153"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="374.5" y="134.1602"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="982.6846" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="374.5" y="199.9009"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="247.8823"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="335.6045"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="507.0488"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="883.1782"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="29.2407" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="379.5" y="1057.6226"/><rect fill="#FFFFFF" filter="url(#f1gb5c6tisi9u5)" height="692.7773" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="550.5" y="306.3638"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="284.4072" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="555.5" y="394.0859"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="695.7773" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="631.5" y="477.8081"/><rect fill="#A9DCDF" filter="url(#f1gb5c6tisi9u5)" height="217.3054" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="636.5" y="578.1506"/><polygon fill="#A80036" points="169.5,100.9194,179.5,104.9194,169.5,108.9194,173.5,104.9194" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59.5" x2="175.5" y1="104.9194" y2="104.9194"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="66.5" y="99.8281">Client.new(:$uri)</text><polygon fill="#A80036" points="362.5,130.1602,372.5,134.1602,362.5,138.1602,366.5,134.1602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="368.5" y1="134.1602" y2="134.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="198.5" y="129.0688">Monitor.instance()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="379.5" x2="426.5" y1="186.9009" y2="186.9009"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="426.5" y1="186.9009" y2="199.9009"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="385.5" x2="426.5" y1="199.9009" y2="199.9009"/><polygon fill="#A80036" points="395.5,195.9009,385.5,199.9009,395.5,203.9009,391.5,199.9009" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M434,177.1602 L434,217.1602 L742,217.1602 L742,187.1602 L732,177.1602 L434,177.1602 " fill="#FBFB77" filter="url(#f1gb5c6tisi9u5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M732,177.1602 L732,187.1602 L742,187.1602 L732,177.1602 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="440" y="194.3096">Monitor started in thread and runs for all</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="440" y="209.5503">servers. Monitor ends when application ends.</text><polygon fill="#A80036" points="367.5,243.8823,377.5,247.8823,367.5,251.8823,371.5,247.8823" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="373.5" y1="247.8823" y2="247.8823"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="198.5" y="242.791">emit heartbeatfrequency</text><polygon fill="#A80036" points="202.5,273.123,192.5,277.123,202.5,281.123,198.5,277.123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="196.5" x2="373.5" y1="277.123" y2="277.123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="208.5" y="272.0317">done</text><polygon fill="#A80036" points="538.5,302.3638,548.5,306.3638,538.5,310.3638,542.5,306.3638" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="544.5" y1="306.3638" y2="306.3638"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="198.5" y="301.2725">Server.new(...)</text><polygon fill="#A80036" points="400.5,331.6045,390.5,335.6045,400.5,339.6045,396.5,335.6045" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="394.5" x2="549.5" y1="335.6045" y2="335.6045"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="406.5" y="330.5132">emit register server</text><polygon fill="#A80036" points="538.5,360.8452,548.5,364.8452,538.5,368.8452,542.5,364.8452" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384.5" x2="544.5" y1="364.8452" y2="364.8452"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="391.5" y="359.7539">Done</text><polygon fill="#A80036" points="543.5,390.0859,553.5,394.0859,543.5,398.0859,547.5,394.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384.5" x2="549.5" y1="394.0859" y2="394.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="391.5" y="388.9946">emit monitor data</text><polygon fill="#A80036" points="207.5,431.947,197.5,435.947,207.5,439.947,203.5,435.947" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="201.5" x2="554.5" y1="435.947" y2="435.947"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="213.5" y="430.8557">emit add servers</text><path d="M570,407.0859 L570,447.0859 L790,447.0859 L790,417.0859 L780,407.0859 L570,407.0859 " fill="#FBFB77" filter="url(#f1gb5c6tisi9u5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M780,407.0859 L780,417.0859 L790,417.0859 L780,407.0859 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="576" y="424.2354">Servers can get other server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="576" y="439.4761">names from the is-master info.</text><polygon fill="#A80036" points="619.5,473.8081,629.5,477.8081,619.5,481.8081,623.5,477.8081" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="196.5" x2="625.5" y1="477.8081" y2="477.8081"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="203.5" y="472.7168">Server.new(...)</text><polygon fill="#A80036" points="400.5,503.0488,390.5,507.0488,400.5,511.0488,396.5,507.0488" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="394.5" x2="630.5" y1="507.0488" y2="507.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="406.5" y="501.9575">emit register server</text><polygon fill="#A80036" points="619.5,532.2896,629.5,536.2896,619.5,540.2896,623.5,536.2896" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384.5" x2="625.5" y1="536.2896" y2="536.2896"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="391.5" y="531.1982">Done</text><polygon fill="#A80036" points="624.5,574.1506,634.5,578.1506,624.5,582.1506,628.5,578.1506" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384.5" x2="630.5" y1="578.1506" y2="578.1506"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="391.5" y="573.0593">emit monitor data</text><path d="M651,549.2896 L651,589.2896 L846,589.2896 L846,559.2896 L836,549.2896 L651,549.2896 " fill="#FBFB77" filter="url(#f1gb5c6tisi9u5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M836,549.2896 L836,559.2896 L846,559.2896 L836,549.2896 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="657" y="566.439">Server2 acts like server1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="657" y="581.6797">only shown here for thread.</text><polygon fill="#A80036" points="543.5,616.0117,553.5,620.0117,543.5,624.0117,547.5,620.0117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="549.5" y1="620.0117" y2="620.0117"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="198.5" y="614.9204">done</text><polygon fill="#A80036" points="207.5,645.2524,197.5,649.2524,207.5,653.2524,203.5,649.2524" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="201.5" x2="554.5" y1="649.2524" y2="649.2524"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="213.5" y="644.1611">emit server state</text><polygon fill="#A80036" points="538.5,674.4932,548.5,678.4932,538.5,682.4932,542.5,678.4932" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="544.5" y1="678.4932" y2="678.4932"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="198.5" y="673.4019">done</text><polygon fill="#A80036" points="207.5,703.7339,197.5,707.7339,207.5,711.7339,203.5,707.7339" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="201.5" x2="635.5" y1="707.7339" y2="707.7339"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="213.5" y="702.6426">emit add servers</text><polygon fill="#A80036" points="624.5,732.9746,634.5,736.9746,624.5,740.9746,628.5,736.9746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="630.5" y1="736.9746" y2="736.9746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="198.5" y="731.8833">done</text><polygon fill="#A80036" points="207.5,762.2153,197.5,766.2153,207.5,770.2153,203.5,766.2153" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="201.5" x2="635.5" y1="766.2153" y2="766.2153"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="213.5" y="761.124">emit server state</text><polygon fill="#A80036" points="619.5,791.4561,629.5,795.4561,619.5,799.4561,623.5,795.4561" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="625.5" y1="795.4561" y2="795.4561"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="198.5" y="790.3647">done</text><polygon fill="#A80036" points="169.5,820.6968,179.5,824.6968,169.5,828.6968,173.5,824.6968" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59.5" x2="175.5" y1="824.6968" y2="824.6968"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="66.5" y="819.6055">.cleanup()</text><polygon fill="#A80036" points="538.5,849.9375,548.5,853.9375,538.5,857.9375,542.5,853.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="544.5" y1="853.9375" y2="853.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="198.5" y="848.8462">.cleanup()</text><polygon fill="#A80036" points="400.5,879.1782,390.5,883.1782,400.5,887.1782,396.5,883.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="394.5" x2="549.5" y1="883.1782" y2="883.1782"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="406.5" y="878.0869">emit unregister server</text><polygon fill="#A80036" points="538.5,908.4189,548.5,912.4189,538.5,916.4189,542.5,912.4189" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384.5" x2="544.5" y1="912.4189" y2="912.4189"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="391.5" y="907.3276">done</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="560.5" x2="602.5" y1="956.9004" y2="956.9004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="602.5" x2="602.5" y1="956.9004" y2="969.9004"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="561.5" x2="602.5" y1="969.9004" y2="969.9004"/><polygon fill="#A80036" points="571.5,965.9004,561.5,969.9004,571.5,973.9004,567.5,969.9004" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="567.5" y="936.5684">cleanup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="567.5" y="951.8091">sockets</text><polygon fill="#A80036" points="202.5,995.1411,192.5,999.1411,202.5,1003.1411,198.5,999.1411" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="196.5" x2="554.5" y1="999.1411" y2="999.1411"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="208.5" y="994.0498">done</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="546.5" x2="564.5" y1="990.1411" y2="1008.1411"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="546.5" x2="564.5" y1="1008.1411" y2="990.1411"/><polygon fill="#A80036" points="619.5,1024.3818,629.5,1028.3818,619.5,1032.3818,623.5,1028.3818" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="625.5" y1="1028.3818" y2="1028.3818"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="198.5" y="1023.2905">.cleanup()</text><polygon fill="#A80036" points="400.5,1053.6226,390.5,1057.6226,400.5,1061.6226,396.5,1057.6226" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="394.5" x2="630.5" y1="1057.6226" y2="1057.6226"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="406.5" y="1052.5313">emit unregister server</text><polygon fill="#A80036" points="619.5,1082.8633,629.5,1086.8633,619.5,1090.8633,623.5,1086.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384.5" x2="625.5" y1="1086.8633" y2="1086.8633"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="391.5" y="1081.772">done</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="641.5" x2="683.5" y1="1131.3447" y2="1131.3447"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683.5" x2="683.5" y1="1131.3447" y2="1144.3447"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="642.5" x2="683.5" y1="1144.3447" y2="1144.3447"/><polygon fill="#A80036" points="652.5,1140.3447,642.5,1144.3447,652.5,1148.3447,648.5,1144.3447" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="648.5" y="1111.0127">cleanup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="648.5" y="1126.2534">sockets</text><polygon fill="#A80036" points="197.5,1169.5854,187.5,1173.5854,197.5,1177.5854,193.5,1173.5854" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="191.5" x2="635.5" y1="1173.5854" y2="1173.5854"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="203.5" y="1168.4941">done</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="627.5" x2="645.5" y1="1164.5854" y2="1182.5854"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="627.5" x2="645.5" y1="1182.5854" y2="1164.5854"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="177.5" x2="195.5" y1="1164.5854" y2="1182.5854"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="177.5" x2="195.5" y1="1182.5854" y2="1164.5854"/><!--
@startuml


skinparam sequence {
  LifeLineBackgroundColor #fff
}

participant Application
activate Application

participant Client

Application -> Client: Client.new(:$uri)
activate Client

box "never\nending" #efffff
  participant Monitor
end box

Client -> Monitor ++: Monitor.instance()
deactivate Monitor
Monitor -> Monitor ++ #A9DCDF:
note right
  Monitor started in thread and runs for all
  servers. Monitor ends when application ends.
end note

Client -> Monitor ++ : emit heartbeatfrequency
Monitor -> Client - -: done

Client -> Server1 ++: Server.new(...)
Server1 -> Monitor ++: emit register server
Monitor -> Server1 - -: Done

Monitor -> Server1 ++ #A9DCDF: emit monitor data

Server1 -> Client ++ #A9DCDF: emit add servers
  note right
    Servers can get other server
    names from the is-master info.
  end note

  Client -> Server2 ++ #A9DCDF: Server.new(...)
  Server2 -> Monitor ++ #A9DCDF: emit register server
  Monitor -> Server2 - -: Done
  Monitor -> Server2 ++ #A9DCDF: emit monitor data
  note right
    Server2 acts like server1
    only shown here for thread.
  end note

Client -> Server1 - -: done
Server1 -> Client ++ #A9DCDF: emit server state
Client -> Server1 - -: done
deactivate Server1

Server2 -> Client ++ #A9DCDF: emit add servers
Client -> Server2 - -: done
Server2 -> Client ++ #A9DCDF: emit server state
Client -> Server2 - -: done
deactivate Server2


Application -> Client: .cleanup()
Client -> Server1: .cleanup()
Server1 -> Monitor ++: emit unregister server
Monitor -> Server1 - -: done
Server1 -> Server1: cleanup\nsockets
Server1 -> Client: done
destroy Server1

Client -> Server2: .cleanup()
Server2 -> Monitor ++ #A9DCDF: emit unregister server
Monitor -> Server2 - - #A9DCDF: done
Server2 -> Server2: cleanup\nsockets
Server2 -> Client: done
destroy Server2

destroy Client

@enduml

PlantUML version 1.2019.01(Sat Feb 09 16:32:04 CET 2019)
(LGPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_265-b01
Operating System: Linux
OS Version: 5.8.15-101.fc31.x86_64
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>